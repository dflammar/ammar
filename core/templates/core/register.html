{% extends 'core/base.html' %}
{% load socialaccount %}

{% block title %}ุฅูุดุงุก ุญุณุงุจ - ููุตุฉ ุงูุชุนููู{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="auth-form bg-white rounded-4 shadow">
                <div class="text-center mb-4">
                    <h2 class="fw-bold text-primary">๐ ุฃูุดุฆ ุญุณุงุจู ุงูุขู!</h2>
                    <p class="text-muted">ุฃุฏุฎู ุจูุงูุงุชู ููุญุตูู ุนูู ุชุฌุฑุจุฉ ุชุนููููุฉ ูุฑูุฏุฉ ูุฃูุซุฑ ุชูุงุนูุงู</p>
                </div>

                <form method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="first_name" class="form-label fw-bold text-primary">ุงูุงุณู ุงูุฃูู</label>
                        <input type="text" class="form-control form-control-lg border-2"
                               id="first_name" name="first_name"
                               placeholder="ุฃุฏุฎู ุงูุงุณู ุงูุฃูู" required>
                    </div>

                    <div class="mb-3">
                        <label for="last_name" class="form-label fw-bold text-primary">ุงูุงุณู ุงูุฃุฎูุฑ</label>
                        <input type="text" class="form-control form-control-lg border-2"
                               id="last_name" name="last_name"
                               placeholder="ุฃุฏุฎู ุงูุงุณู ุงูุฃุฎูุฑ" required>
                    </div>

                    <div class="mb-3">
                        <label for="phone_number" class="form-label fw-bold text-primary">ุฑูู ุงููุงุชู</label>
                        <input type="text" class="form-control form-control-lg border-2"
                               id="phone_number" name="phone_number"
                               placeholder="ุฃุฏุฎู ุฑูู ุงููุงุชู" required>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label fw-bold text-primary">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                        <input type="email" class="form-control form-control-lg border-2"
                               id="email" name="email"
                               placeholder="ุฃุฏุฎู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" required>
                    </div>

                    <div class="mb-3">
                        <label for="grade" class="form-label fw-bold text-primary">ุงูุตู ุงูุฏุฑุงุณู</label>
                        <select class="form-select form-select-lg border-2" id="grade" name="grade" required>
                            <option value="" selected disabled>- ุงุฎุชุฑ ุงูุตู ุงูุฏุฑุงุณู -</option>
                            {% for grade in grades %}
                                <option value="{{ grade.id }}">{{ grade.name_ar }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="password" class="form-label fw-bold text-primary">ูููุฉ ุงูุณุฑ</label>
                        <input type="password" class="form-control form-control-lg border-2"
                               id="password" name="password"
                               placeholder="ุฃุฏุฎู ูููุฉ ุงูุณุฑ" required>
                    </div>

                    <div class="mb-4">
                        <label for="password_confirm" class="form-label fw-bold text-primary">ุชุฃููุฏ ูููุฉ ุงูุณุฑ</label>
                        <input type="password" class="form-control form-control-lg border-2"
                               id="password_confirm" name="password_confirm"
                               placeholder="ุฃุนุฏ ุฅุฏุฎุงู ูููุฉ ุงูุณุฑ" required>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-danger btn-lg fw-bold py-3">ุฅูุดุงุก ุงูุญุณุงุจ</button>
                    </div>
                </form>

                <div class="text-center mt-4">
                    <p>ูุฏูู ุญุณุงุจ ุจุงููุนูุ <a href="{% url 'core:login' %}" class="text-danger fw-bold">ุชุณุฌูู ุงูุฏุฎูู</a></p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Add phone number validation
    document.getElementById('phone_number').addEventListener('input', function(e) {
        // Allow only numbers
        this.value = this.value.replace(/[^0-9]/g, '');
    });

    // Add password confirmation validation
    document.querySelector('form').addEventListener('submit', function(e) {
        const password = document.getElementById('password').value;
        const passwordConfirm = document.getElementById('password_confirm').value;

        if (password !== passwordConfirm) {
            e.preventDefault();
            alert('ูููุงุช ุงููุฑูุฑ ุบูุฑ ูุชุทุงุจูุฉ');
        }
    });

    // Check if phone number already exists
    document.getElementById('phone_number').addEventListener('blur', function() {
        const phoneNumber = this.value;
        if (phoneNumber.length > 0) {
            fetch('{% url "core:check_phone_exists" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    phone_number: phoneNumber
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.exists) {
                    alert('ุฑูู ุงููุงุชู ูุณุฌู ุจุงููุนูุ ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู');
                }
            });
        }
    });

    // Check if email already exists
    document.getElementById('email').addEventListener('blur', function() {
        const email = this.value;
        if (email.length > 0 && email.includes('@')) {
            fetch('{% url "core:check_phone_exists" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    email: email
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.exists) {
                    alert('ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุณุฌู ุจุงููุนูุ ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู');
                }
            });
        }
    });

    // Add animation when grade is selected
    document.getElementById('grade').addEventListener('change', function() {
        const gradeId = this.value;
        if (gradeId) {
            // Add a subtle animation to show selection was successful
            this.classList.add('border-success');
            setTimeout(() => {
                this.classList.remove('border-success');
            }, 1000);
        }
    });
</script>
{% endblock %}
